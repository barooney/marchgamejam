<!doctype html>
<script src="lib/jquery-1.11.0.min.js"></script>
<script src="castlePos.js"></script>
<script src="helpers.js"></script>
<script src="castle.js"></script>
<script src="soldier.js"></script>

<head>
<title>revolution</title>
<meta charset="utf-8">

</head>
<div style="display: table; width: 100%; height: 100%;">
	<canvas id="myCanvas" width="640" height="480"
		style="border: 1px solid #000000; display: table-cell; margin: auto;">





</div>
<script>

var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");

var castleImg = new Image(); // HTML5 Constructor
castleImg.src = 'img/40x40castle.png';

var backgroundImg = new Image();
backgroundImg.src = 'img/background.png';

var animFrame = 0;
var animFrameCtr = 0;
var animFrameMax = 3;
var soldierImgs1 = [new Image(), new Image(), new Image];
soldierImgs1[0].src = 'img/knight_1orange.png';
soldierImgs1[1].src = 'img/knight_2orange.png';
soldierImgs1[2].src = 'img/knight_3orange.png';

var castles = [];
for(castlePosIndex in castlePosArray) {
	var curPosObj = castlePosArray[castlePosIndex];
	var curCastle = new castle();
	curCastle.posX = curPosObj.x;
	curCastle.posY = curPosObj.y;
	castles.push(curCastle);
}
// castles.reverse();

// connect to neighbours
for(castleIndex in castles) {
	var curCastleNeighbourIndizes =  castlePosArray[castleIndex].neighbours;
	var curCastle =  castles[castleIndex];
	
	
	for(curCastleNeighbourIndizesIndex in curCastleNeighbourIndizes) {
		var curNeighbourIndex = curCastleNeighbourIndizes[curCastleNeighbourIndizesIndex];
		curCastle.neighbours.push(castles[curNeighbourIndex]);
	}
}

var soldiers = [ new soldier()];
soldiers[0].startingCastle = castles[1];
soldiers[0].targetCastle = castles[2];

var xpos = 80;
var ypos = 32.5;

  function drawTriangle(ctx) {
   
  ctx.fillStyle = "#000000";
  ctx.beginPath();
  ctx.moveTo(240+xpos, 0+ypos);
  ctx.lineTo(480+xpos,Math.sqrt(3)/2*480+ypos);
  ctx.lineTo(0+xpos,Math.sqrt(3)/2*480+ypos);
  ctx.closePath();
  ctx.fill();
    
}
fly();

function fly() {
	ctx.clearRect(0, 0, 640, 480);
  ctx.drawImage(backgroundImg, 0, 0);
  animFrameCtr++;
  if (animFrameCtr < animFrameMax) {
    
  } else {
    animFrame++;
    animFrameCtr = 0;
  }
  animFrame = (animFrame > 2) ? 0 : animFrame;
	for(castleIndex in castles) {
		castles[castleIndex].drawStreets();
	}
	for(castleIndex in castles) {
		castles[castleIndex].drawMe();
	}
	for(soldierIndex in soldiers) {
		soldiers[soldierIndex].progress += 0.01;
		soldiers[soldierIndex].progress = Math.min(soldiers[soldierIndex].progress, 1.0);
		soldiers[soldierIndex].drawMe();
	}
}

setInterval(fly, 50);

$('canvas').click(function(e) {
  x = e.pageX - this.offsetLeft,
  y = e.pageY - this.offsetTop;

  for (var c in castles) {
    if (castles[c].isInside(x,y)) {
      // TODO: add logic to turn target
    }
  }
});

</script>

</canvas>

